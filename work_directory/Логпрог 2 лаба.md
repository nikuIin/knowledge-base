
---

### Условие задачи
Три мальчика — Коля, Миша и Саша — и кто-то из них разбил вазу. Они сделали такие заявления:
- **Коля**: «Миша не разбивал вазу, а Саша разбил».
- **Миша**: «Я не разбивал, и Коля тоже не разбивал».
- **Саша**: «Я не разбивал, а Миша разбил».
Известно:
- Один из них сказал **правду** в обоих своих утверждениях
- Один **соврал** в обоих утверждениях
- Один сказал правду в одном утверждении, а в другом соврал 
**Цель**: определить, кто разбил вазу.

---

### Формализация задачи
Согласно документу, любая логическая головоломка состоит из **фактов**, **правил** и **цели**. Давай разберём задачу по этим частям.

#### 1. Факты
- Есть три мальчика: Коля, Миша, Саша.
- Один из них разбил вазу (назовём его `Breaker` — «Разбивший»).
- Их заявления:
  - Коля: «Миша не разбивал» и «Саша разбил».
  - Миша: «Я не разбивал» и «Коля не разбивал».
  - Саша: «Я не разбивал» и «Миша разбил».
- Условия:
  - Один мальчик — Правдивый (оба утверждения истинны).
  - Один — Лжец (оба утверждения ложны).
  - Один — Полуправдивый (одно утверждение истинно, другое ложно).

#### 2. Правила
- Каждое заявление можно проверить:
  - «Миша не разбивал» истинно, если `Breaker \= misha` (Разбивший — не Миша).
  - «Саша разбил» истинно, если `Breaker = sasha` (Разбивший — Саша).
  - И так далее для остальных заявлений.
- Условия правдивости:
  - Для Правдивого: оба его утверждения истинны.
  - Для Лжеца: оба утверждения ложны.
  - Для Полуправдивого: ровно одно утверждение истинно, другое ложно.
- Все три роли (Правдивый, Лжец, Полуправдивый) принадлежат разным мальчикам.

#### 3. Цель
- Найти `Breaker` — того, кто разбил вазу.
- Для полноты можно также определить, кто Правдивый, Лжец и Полуправдивый.

---

### Логический анализ
Чтобы решить задачу, нужно:
1. Определить, когда каждое заявление истинно или ложно, в зависимости от того, кто `Breaker`.
2. Назначить роли (Правдивый, Лжец, Полуправдивый) так, чтобы:
   - У одного мальчика оба утверждения были истинны.
   - У одного оба ложны.
   - У одного одно истинно, одно ложно.
3. Убедиться, что роли принадлежат разным мальчикам.
4. Найти `Breaker`, который удовлетворяет всем условиям.

#### Заявления в логической форме
1. **Коля**:
   - «Миша не разбивал»: истинно, если `Breaker \= misha`.
   - «Саша разбил»: истинно, если `Breaker = sasha`.
2. **Миша**:
   - «Я не разбивал»: истинно, если `Breaker \= misha`.
   - «Коля не разбивал»: истинно, если `Breaker \= kolya`.
3. **Саша**:
   - «Я не разбивал»: истинно, если `Breaker \= sasha`.
   - «Миша разбил»: истинно, если `Breaker = misha`.

#### Условия ролей
- **Правдивый**:
  - Если Коля — Правдивый, то `Breaker \= misha` и `Breaker = sasha`.
  - Если Миша — Правдивый, то `Breaker \= misha` и `Breaker \= kolya`.
  - Если Саша — Правдивый, то `Breaker \= sasha` и `Breaker = misha`.
- **Лжец**:
  - Если Коля — Лжец, то `Breaker = misha` и `Breaker \= sasha`.
  - Если Миша — Лжец, то `Breaker = misha` и `Breaker = kolya`.
  - Если Саша — Лжец, то `Breaker = sasha` и `Breaker \= misha`.
- **Полуправдивый**:
  - Если Коля — Полуправдивый, то ровно одно из: `Breaker \= misha` или `Breaker = sasha` истинно.
  - Если Миша — Полуправдивый, то ровно одно из: `Breaker \= misha` или `Breaker \= kolya` истинно.
  - Если Саша — Полуправдивый, то ровно одно из: `Breaker \= sasha` или `Breaker = misha` истинно.

---

### Реализация на Прологе
Мы создадим программу, которая:
- Определяет правдивость заявлений для каждого мальчика.
- Назначает роли (Правдивый, Лжец, Полуправдивый) с учётом условий.
- Находит `Breaker`.

#### Стратегия
- **Переменные**:
  - `Breaker`: кто разбил вазу (`kolya`, `misha`, `sasha`).
  - `Truthful`, `Liar`, `HalfTruth`: мальчики, выполняющие роли Правдивого, Лжеца и Полуправдивого.
- **Предикаты**:
  - `statement_truth(Person, Breaker, Truth1, Truth2)`: вычисляет правдивость двух заявлений мальчика в зависимости от `Breaker`.
  - `solve(Breaker, Truthful, Liar, HalfTruth)`:
    - Выбирает `Breaker`.
    - Вычисляет правдивость всех заявлений.
    - Назначает роли, проверяя условия.
    - Гарантирует, что мальчики в ролях разные.
- **Ограничения**:
  - Используем `member/2` для выбора `Breaker`.
  - Используем `choose/2` (из примеров в документе) для назначения разных мальчиков на роли.
  - Проверяем условия правдивости для каждой роли.
- **Цель**:
  - Запрос `?- solve(Breaker, _, _, _).` найдёт `Breaker`.

---

### Код на Прологе
Ниже полный код программы. Он включает:
- Вспомогательный предикат `choose/2` для выбора разных значений.
- Предикат `statement_truth/4` для вычисления правдивости заявлений.
- Главный предикат `solve/4` для решения задачи.
- Автоматический запрос для вывода результата.

```prolog
% Вспомогательный предикат для выбора разных значений из списка
choose([], _).
choose([H|T], Values) :- 
    member(H, Values),
    choose(T, Values),
    \+ member(H, T).

% Предикат для определения правдивости заявлений каждого мальчика
statement_truth(kolya, Breaker, Truth1, Truth2) :-
    (Breaker \= misha -> Truth1 = true ; Truth1 = false),
    (Breaker = sasha -> Truth2 = true ; Truth2 = false).
statement_truth(misha, Breaker, Truth1, Truth2) :-
    (Breaker \= misha -> Truth1 = true ; Truth1 = false),
    (Breaker \= kolya -> Truth2 = true ; Truth2 = false).
statement_truth(sasha, Breaker, Truth1, Truth2) :-
    (Breaker \= sasha -> Truth1 = true ; Truth1 = false),
    (Breaker = misha -> Truth2 = true ; Truth2 = false).

% Главный предикат для решения головоломки
solve(Breaker, Truthful, Liar, HalfTruth) :-
    % Выбираем Разбившего
    member(Breaker, [kolya, misha, sasha]),
    
    % Вычисляем правдивость заявлений для каждого мальчика
    statement_truth(kolya, Breaker, KolyaTruth1, KolyaTruth2),
    statement_truth(misha, Breaker, MishaTruth1, MishaTruth2),
    statement_truth(sasha, Breaker, SashaTruth1, SashaTruth2),
    
    % Назначаем роли: Правдивый (оба истинны), Лжец (оба ложны), Полуправдивый (одно истинно)
    choose([Truthful, Liar, HalfTruth], [kolya, misha, sasha]),
    
    % Правдивый: оба утверждения истинны
    (Truthful = kolya -> (KolyaTruth1 = true, KolyaTruth2 = true) ;
     Truthful = misha -> (MishaTruth1 = true, MishaTruth2 = true) ;
     Truthful = sasha -> (SashaTruth1 = true, SashaTruth2 = true)),
    
    % Лжец: оба утверждения ложны
    (Liar = kolya -> (KolyaTruth1 = false, KolyaTruth2 = false) ;
     Liar = misha -> (MishaTruth1 = false, MishaTruth2 = false) ;
     Liar = sasha -> (SashaTruth1 = false, SashaTruth2 = false)),
    
    % Полуправдивый: ровно одно утверждение истинно
    (HalfTruth = kolya ->
        ((KolyaTruth1 = true, KolyaTruth2 = false) ; (KolyaTruth1 = false, KolyaTruth2 = true)) ;
     HalfTruth = misha ->
        ((MishaTruth1 = true, MishaTruth2 = false) ; (MishaTruth1 = false, MishaTruth2 = true)) ;
     HalfTruth = sasha ->
        ((SashaTruth1 = true, SashaTruth2 = false) ; (SashaTruth1 = false, SashaTruth2 = true))).

% Автоматический запрос для вывода результата
:- solve(Breaker, Truthful, Liar, HalfTruth),
   format('Кто разбил вазу: ~w~n', [Breaker]),
   format('Правдивый: ~w, Лжец: ~w, Полуправдивый: ~w~n', [Truthful, Liar, HalfTruth]),
   halt.
```

---

### Как работает код

1. **Предикат `choose/2`**:
   - Это вспомогательный предикат из примера в документе. Он гарантирует, что роли (`Truthful`, `Liar`, `HalfTruth`) назначены разным мальчикам.
   - Например, если `Truthful = kolya`, то `Liar` и `HalfTruth` могут быть только `misha` или `sasha`.

2. **Предикат `statement_truth/4`**:
   - Для каждого мальчика (`Person`) вычисляет правдивость его двух заявлений в зависимости от `Breaker`.
   - Для Коли:
     - Первое заявление («Миша не разбивал»): `Truth1 = true`, если `Breaker \= misha`, иначе `false`.
     - Второе заявление («Саша разбил»): `Truth2 = true`, если `Breaker = sasha`, иначе `false`.
   - Аналогично для Миши и Саши, согласно их заявлениям.
   - Возвращает `Truth1` и `Truth2` как `true` или `false`.

3. **Предикат `solve/4`**:
   - Выбирает `Breaker` из списка `[kolya, misha, sasha]` с помощью `member/2`.
   - Вычисляет правдивость всех заявлений для каждого мальчика с помощью `statement_truth/4`.
   - Назначает роли (`Truthful`, `Liar`, `HalfTruth`) с помощью `choose/2`, чтобы они были разными.
   - Проверяет условия:
     - Для `Truthful`: оба утверждения — `true`.
     - Для `Liar`: оба утверждения — `false`.
     - Для `HalfTruth`: одно утверждение — `true`, другое — `false`.
   - Пролог перебирает все комбинации `Breaker` и ролей, пока не найдёт подходящую.

4. **Автоматический запрос**:
   - Запускает `solve(Breaker, Truthful, Liar, HalfTruth)` и выводит:
     - Кто разбил вазу (`Breaker`).
     - Кто Правдивый, Лжец и Полуправдивый (для полноты).
   - `halt` останавливает программу после вывода результата.

---

### Ожидаемый результат
При запуске программы в SWI-Prolog вывод будет примерно таким:
```
Кто разбил вазу: misha
Правдивый: sasha, Лжец: kolya, Полуправдивый: misha
```

**Объяснение результата**:
- **Миша разбил вазу** (`Breaker = misha`).
- **Саша — Правдивый**:
  - Заявления: «Я не разбивал» (`Breaker \= sasha`, истинно, так как Миша разбил) и «Миша разбил» (`Breaker = misha`, истинно).
  - Оба утверждения истинны, что соответствует роли Правдивого.
- **Коля — Лжец**:
  - Заявления: «Миша не разбивал» (`Breaker \= misha`, ложно, так как Миша разбил) и «Саша разбил» (`Breaker = sasha`, ложно).
  - Оба утверждения ложны, что соответствует роли Лжеца.
- **Миша — Полуправдивый**:
  - Заявления: «Я не разбивал» (`Breaker \= misha`, ложно, так как Миша разбил) и «Коля не разбивал» (`Breaker \= kolya`, истинно).
  - Одно утверждение истинно, одно ложно, что соответствует роли Полуправдивого.

---

### Ручная проверка
Чтобы убедиться, что решение верно, проверим для `Breaker = misha`:
- **Коля**:
  - «Миша не разбивал» (`Breaker \= misha`): ложно.
  - «Саша разбил» (`Breaker = sasha`): ложно.
  - Итог: оба ложно → Коля — Лжец.
- **Миша**:
  - «Я не разбивал» (`Breaker \= misha`): ложно.
  - «Коля не разбивал» (`Breaker \= kolya`): истинно.
  - Итог: одно истинно, одно ложно → Миша — Полуправдивый.
- **Саша**:
  - «Я не разбивал» (`Breaker \= sasha`): истинно.
  - «Миша разбил» (`Breaker = misha`): истинно.
  - Итог: оба истинно → Саша — Правдивый.

Роли (Правдивый: Саша, Лжец: Коля, Полуправдивый: Миша) и `Breaker = misha` удовлетворяют всем условиям.

---

### Как запустить программу
1. Сохрани код в файл, например, `who_broke_vase.pl`.
2. Открой SWI-Prolog в терминале или через графический интерфейс.
3. Загрузи файл:
   ```prolog
   ?- ['who_broke_vase.pl'].
   ```
4. Программа автоматически выполнит запрос и выведет результат, например:
   ```
   Кто разбил вазу: misha
   Правдивый: sasha, Лжец: kolya, Полуправдивый: misha
   ```

---

### Дополнение: связь с 15-м вопросом
В 15-м вопросе мы обсуждали управление поиском с помощью `fail` и `!`. В этой программе они не используются, так как задача требует только одно решение, и Пролог находит его автоматически. Однако, если бы мы хотели, например, вывести все возможные решения (хотя в этой задаче есть только одно), можно было бы добавить `fail` для перебора. Отсечение `!` могло бы использоваться, если бы мы хотели явно ограничить поиск первым решением, но здесь это не нужно, так как условия жёсткие.

---

Если что-то осталось непонятным, нужно добавить трассировку или ещё примеры, напиши!