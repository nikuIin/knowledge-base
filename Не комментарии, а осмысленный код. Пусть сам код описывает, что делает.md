#python

[[Чистота кода]]
[[Python.canvas|Python canvas]]

Вместо того, чтобы в методе описывать, что делает конкретные строки кода, лучше вынести их в отдельную функцию и грамотно ее назвать.

Например, была задача по форматированию телефона, нужно было провести 3 этапа:
- удалить все цифры
- удалить код страны
- добавить единый начальный символ (`8`) и добавить единое форматирование (`8 (9xx)-xxx-xx-xx`)

3 этапа, а значит и 3 части кода.

### Неправильный подход

Можно расписать все в единой функции `phone_formatter` и если мы не совсем отбитые, до добавить комментарии к тому, что код делает:

```python
from re import sub

VALID_PHONE_LENGTH = 11  # 8_900_555_55_55 e.g. (not considering '_')


def format_phone(phone_number: str) -> str:
    """Функция возвращает отформатированный телефон.

    Args:
        phone_number: исходный телефон

    Returns:
        отформатированный телефон
    """
    formatted_phone_number = ""

    # Remove all non-digit characters from the phone number
    delete_chars_pattern = r"[\D]+"
    formatted_phone_number = sub(pattern=delete_chars_pattern, repl="", string=phone_number)

    # delete country code (or '8' if phone in the russian-internal format)
    # if phone has valid lenght
    if (
        formatted_phone_number.startswith("89")
        or formatted_phone_number.startswith("79")
        and len(formatted_phone_number) == VALID_PHONE_LENGTH
    ):
        formatted_phone_number = formatted_phone_number[1:]

    # if phone length valid then formating
    # VALID_PHONE_LENGTH - 1 because the phone without starting country code
    if len(formatted_phone_number) == VALID_PHONE_LENGTH - 1:
        formatted_phone_number = (
            f"8 ({formatted_phone_number[:3]})"
            f" {formatted_phone_number[3:6]}"
            f"-{formatted_phone_number[6:8]}"
            f"-{formatted_phone_number[8:10]}"
        )

    return formatted_phone_number
```

Да, комментарии повышают читаемость кода, но они не постоянно, а код постоянный. И тут важно то, **чтобы код говорил, что он делает**.

### Правильное решение

Правильным решением выделить все части форматирование в 3 разные функции:
- `remove_non_digits`
- `remove_country_code`
- `format_to_display`

И далее, в исходном методе `format_phone` мы создаем список `formatters` из функций форматеров и просто проходимся по ней, очень удобно и понятно!

```python
from re import sub

VALID_PHONE_LENGTH = 11  # 8_900_555_55_55 e.g. (not considering '_')


def format_phone(phone_number: str) -> str:
    """Функция возвращает отформатированный телефон.

    Args:
        phone_number: исходный телефон

    Returns:
        отформатированный телефон
    """
    formatters = (
        remove_non_digits_chars,
        remove_country_code_from_number,
        format_phone_for_display,
    )

    for formatter in formatters:
        phone_number = formatter(phone_number)

    return phone_number


def remove_non_digits_chars(text: str) -> str:
    delete_chars_pattern = r"[\D]+"
    return sub(string=text, pattern=delete_chars_pattern, repl="")


def remove_country_code_from_number(phone: str) -> str:
    """Removes the country code from a phone number if it starts with '89' or '79' and has a valid length.

    Args:
        phone: The phone number to process.

    Returns:
        The phone number without the country code if applicable, otherwise the original number.
    """
    if phone.startswith("89") or phone.startswith("79") and len(phone) == VALID_PHONE_LENGTH:
        phone = phone[1:]
    return phone


def format_phone_for_display(phone_number: str) -> str:
    """Formats a phone number into a readable format with parentheses and hyphens.

    Args:
        phone_number: The phone number string to format.

    Returns:
        The formatted phone number string.
    """
    if len(phone_number) == VALID_PHONE_LENGTH - 1:
        return f"8 ({phone_number[:3]}) {phone_number[3:6]}-{phone_number[6:8]}-{phone_number[8:10]}"
    return phone_number
```




## Вывод

#совет

Если вы хотите написать комментарии к куску кода, то вынесите его в отдельную функцию. 
Комментарии нужно писать тогда и только тогда, когда вы пишите сложную бизнес логику и используете непонятные конструкции, создаете костыли (делаете это осознано по каким-либо причинам).


