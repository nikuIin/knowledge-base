[[postgreSQL]]

__Функция__ — это именованный блок кода, который оперирует входными данными и всегда возвращает какое-либо значение (_void_ тоже считается)

__Процедура__ — это именованный блок кода, который производит некоторые действия над каким-либо картежом данных.


_Примеры функций в postgreSQL на языке PL/pgsql_:
* `Функция` деления двух чисел с `exception`:
```sql
create or replace function divide_two_numbers(divide numeric, division numeric)
returns numeric
language plpgsql
as $$
declare
  result numeric;
begin
  result =  divide / division;
  return result;
exception
  when division_by_zero then
    raise exception 'Error: division by zero';
end
$$;

select divide_two_numbers(1, 5); -- 0.2
select divide_two_numbers(1, 0); -- Ошибка
```

* `Функция`, оперирующая строкой таблицы `client`:
```sql
create table client(
  client_id bigint generated always as identity primary key,
  first_name varchar(255) not null check(length(first_name) > 0),
  last_name varchar(255) check(length(last_name) > 0),
  middle_name varchar(255) check(length(middle_name) > 0)
);

table client;
-- 1,Вася
-- 2,Вася,Мусечкин,
-- 3,Вася,Мусечкин,Васильевич

create or replace function get_fio(client_data client)
returns varchar(765)
language plpgsql
as $$
declare
  fio varchar(765) := '';
begin
  if client_data.last_name is not null and client_data.middle_name is not null then
    fio = client_data.last_name || ' ' || client_data.first_name || ' ' || client_data.middle_name;
  elseif client_data.last_name is not null and client_data.middle_name is null then
    fio = client_data.last_name || ' ' || client_data.first_name;
  elseif client_data.last_name is null and client_data.middle_name is null then
    fio = client_data.first_name;
  end if;

  return fio;
end;
$$

```

* пример `процедуры` на вставку данных в `client`
```sql
create or replace procedure
  insert_into_client(client_data text)
language
  plpgsql
as $$
declare
  client_array text[];
  first_name varchar(255) := null;
  last_name varchar(255) := null;
  middle_name varchar(255) := null;
begin
  client_array = string_to_array(client_data, ' ');

  if array_length(client_array, 1) = 1 then
    first_name := client_array[1];
  elseif array_length(client_array, 1) = 2 then
    first_name := client_array[1];
    last_name := client_array[2];
  elseif array_length(client_array, 1) = 3 then
    first_name := client_array[1];
    last_name := client_array[2];
    middle_name := client_array[3];
  end if;

  insert into client(first_name, last_name, middle_name)
  values (first_name, last_name, middle_name);
end;
$$;

```