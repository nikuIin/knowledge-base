[[Pytest Тестирование.canvas|Pytest Тестирование]] — канва
[[Книга «Принципы Unit-тестирования» Владимир Хориков]]
[[Тон хорошего тестирования. Хорошее unit тестирование.]]

`AAA` — arange, act, assert — подготовка, действие, проверка. Очень хороший и удобный подход для написание юнит тестов, повышающий их читаемость.

В фазе подготовки идет, как ни странно, подготовка данных. Например, пишутся числа, которые будут потом суммированы. 
В фазе действия идет как раз само действие, например сумма чисел из фазы подготовки.
В фазе проверки идет проверка результата фазы действия с заранее известным результатом.

Как мы помним, юнит тест зачастую тестирует какой-либо метод или класс. Поэтому, в фазе `подготовки`, при объявлении этого объекта, его стоит назвать `sut` — `system under test`. Так вы будете быстрее при чтении понимать, какой код, а точнее действие, логика, проверяется. 

Также делайте отступы между секциями для повышения удобства чтения. Если нужно разбить сами секции, например, секция подготовки может быть слишком большой, то добавляйте комментарии. 

**Никогда не используйте if в тестах** — это плохой знак. Тесты должны быть максимально прямыми и легкими, вы не систему пишете, а ее проверяется. 

### Размеры каждой из фаз

Самая большая фаза — `подготовительная`. В ней может быть много (относительно других фаз) строк. 
Самая маленькая — `исполнительная`. Она всегда должна равняться **1** строке! Если у вас более одной строки, это означает, что тестируемое `API` написано неправильно и метод, который должен обрабатывать бизнес логику, отсутствует. Например:

```python
def test_buy_wine():
	wine = Wine(wine_id=2)
	warhouse = Warhouse()
	sut = WineShop()
	
	sut.buy_wine(wine)
	warhouse.remove(wine)

	assert True
	assert warehouse.wine_quantity == 2	
```

Тут происходит 2 действие, покупка и удаление со склада, что нарушает бизнес логику. При покупке вина оно должно регистрироваться на пользователя и удаляться со склада. То есть за это должен отвечать 1 `API` метод по покупке вина. => тест должен быть:

```python
def test_buy_wine():
	wine = Wine(wine_id=2)
	warhouse = Warhouse()
	sut = WineShop()
	
	sut.buy_wine(wine)

	assert True
	assert warehouse.wine_quantity == 2
```

Можно сразу сказать о размере части `проверка`. Тут тоже все просто, она должна проверять ровно 1 действие. В нашем случае действие — это покупка. Покупка = самой покупке + удалении позиции со склада. Это как раз мы и проверяем.
