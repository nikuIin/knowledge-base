[[FastAPI.canvas|FastAPI]]
[[Alembic — контроль версий баз данных, конфигурация (настройка) алембика]]

**Важно:** *миграция* = *ривизия*

Создать миграцию
```python
alembic revision --autogenerate -m "fix: add unique constraint on the name in the role table"
```
* `--autogenerate` — для автогенирирование на основе изменений в моделях `SQLAlchemy` (?проверить)
* `-m` — сообщение к миграции

# Применяем миграцию к базе данных

```bash
alembic upgrade head
```

Можно накатить до определённой миграции, для этого нужно вместо `head` указать ее `id`. Тут все, как у `git`

# Откатываем миграцию

```bash
alembic downgrade head
```

Если мы посмотрим, что создаётся по пути `migrations/version`, то увидим, что там есть несколько файлов (если мы несколько раз создали миграции/ривизии). Внутри этих файлов есть как раз функции `downgrade` и `upgrade`, в которых и определены изменения. Благодаря ним мы как раз можем накатывать и откатывать миграции.

**Важно:** `alembic` иногда не всемогущь и может что-то не сгенирировать или сгенерировать неправильно. Зачастую он плохо справляется с особенностями определенной `БД`.

Поэтому создание таких вещей, как:
* `индексы`
* `триггеры`
* `правила`
* `функции`
* `процедуры`
* `перечисления` (`enums`)
* `uuid`
* `jsonb`
* `array`
* `inet`
* `tsvector`
* `schema`

Нужно просматривать `alembic`
# Посмотреть историю миграций

```bash
alembic history
```

# Работа с ветками

[Документация alembic. Тема ветки](https://alembic.sqlalchemy.org/en/latest/branches.html)


